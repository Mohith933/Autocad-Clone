<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AutoCAD Web</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<style>
  * {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: Segoe UI, sans-serif;
}
body {
  background: radial-gradient(circle at top, #0b1d33, #050b14);
  color: white;
}

/* HEADER */
.top-bar {
  height: 70px;
  padding: 0 40px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.logo {
  font-size: 22px;
  font-weight: 600;
}

/* CAD AREA */
.cad-wrapper {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 40px;
    min-height: auto;
  padding-bottom: 40px;
}

canvas {
  background: #050b14;
  border: 1px solid rgba(30,124,255,0.4);
  border-radius: 12px;
  width: 1200px;
  height: 560px;
}

/* COMMAND BAR */
.command-bar {
  margin-top: 20px;
  padding: 14px 28px;
  background: rgba(6,18,34,0.9);
  border-radius: 12px;
  display: flex;
  align-items: center;
  gap: 20px;
  box-shadow: inset 0 0 0 1px rgba(30,124,255,0.4);
}

.command-bar span {
  font-size: 18px;
  color: #8fbaff;
}

.command-bar input {
  background: transparent;
  border: none;
  outline: none;
  color: #1e7cff;
  font-size: 18px;
  width: 300px;
}
 .command-bar{
      margin-bottom: 5px;
 }
 #cadCanvas{
    margin-top:10px;

  }
@media (max-width: 768px) {

  /* Keep header but simplify it */
  .top-bar {
    height: 56px;
    padding: 0 16px;
  }
  .logo {
    font-size: 18px;
  }

  /* Prevent vertical stretching */
  body {
    min-height: auto;
  }

  .cad-wrapper {
    padding: 20px 12px;
    height: auto;
  }

  canvas {
    width: 100%;
    max-width: 100%;
     height: 420px;
  }

 .command-bar {
    position: sticky;
    top: 0;
    z-index: 10;
    background: rgba(6,18,34,0.95);
    backdrop-filter: blur(6px);
    margin-bottom: 5px;
  }

  .command-bar input {
    width: 100%;
    font-size: 14px;
  }
  #cadCanvas{
    margin-top:10px;

  }
}
@media (min-width: 769px) and (max-width: 1024px) {
canvas {
  background: #050b14;
  border: 1px solid rgba(30,124,255,0.4);
  border-radius: 12px;
  width: 100%;
  height: 900px;
}
 .command-bar{
      margin-bottom: 5px;
 }
 #cadCanvas{
    margin-top:10px;

  }
}
</style>
<body>
<header class="top-bar">
  <div class="logo">AutoCAD</div>
</header>

<section class="cad-wrapper">

  <div class="command-bar">
    <span>Command:</span>
    <input id="commandInput" placeholder="LINE / RECT / CLEAR" />
  </div>

  <canvas id="cadCanvas"></canvas>

</section>


<script>
const canvas = document.getElementById("cadCanvas");
const ctx = canvas.getContext("2d");
const input = document.getElementById("commandInput");

let currentCommand = "";
let startPoint = null;
let shapes = [];
let selectedShape = null;

const GRID_SIZE = 25;
const SNAP_ON = true;
const STORAGE_KEY = "autocad_web_drawing";



/* SNAP */
function snap(v) {
  return Math.round(v / GRID_SIZE) * GRID_SIZE;
}

/* HISTORY */
let history = [];

function saveState() {
  history.push(JSON.parse(JSON.stringify(shapes)));
}

function undo() {
  if (history.length > 0) {
    shapes = history.pop();
    redraw();
  }
}

/* SAVE / LOAD */
function saveDrawing() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(shapes));
}

function loadDrawing() {
  const data = localStorage.getItem(STORAGE_KEY);
  if (data) {
    shapes = JSON.parse(data);
    redraw();
  }
}

/* GRID */
function drawGrid() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.strokeStyle = "rgba(255,255,255,0.05)";
  for (let x = 0; x < canvas.width; x += GRID_SIZE) {
    ctx.beginPath();
    ctx.moveTo(x, 0);
    ctx.lineTo(x, canvas.height);
    ctx.stroke();
  }
  for (let y = 0; y < canvas.height; y += GRID_SIZE) {
    ctx.beginPath();
    ctx.moveTo(0, y);
    ctx.lineTo(canvas.width, y);
    ctx.stroke();
  }
}

/* REDRAW */
function redraw() {
  drawGrid();
  ctx.strokeStyle = "#1e7cff";
  ctx.lineWidth = 2;

  shapes.forEach(s => {
    if (s.type === "line") {
      ctx.beginPath();
      ctx.moveTo(s.x1, s.y1);
      ctx.lineTo(s.x2, s.y2);
      ctx.stroke();
    }
    if (s.type === "rect") {
      ctx.strokeRect(s.x, s.y, s.w, s.h);
    }
  });
}

/* HIT TEST */
function isNearLine(x, y, line) {
  const d =
    Math.abs(
      (line.y2 - line.y1) * x -
      (line.x2 - line.x1) * y +
      line.x2 * line.y1 -
      line.y2 * line.x1
    ) /
    Math.hypot(line.y2 - line.y1, line.x2 - line.x1);
  return d < 6;
}

/* COMMAND INPUT */
input.addEventListener("keydown", e => {
  if (e.key === "Enter") {
    const cmd = input.value.toUpperCase();
    input.value = "";
    startPoint = null;
    selectedShape = null;

    if (cmd === "UNDO") {
      undo();
      return;
    }

    if (cmd === "SAVE") {
      saveDrawing();
      return;
    }

    if (cmd === "LOAD") {
      loadDrawing();
      return;
    }

    if (cmd === "CLEAR") {
      saveState();
      shapes = [];
      redraw();
      return;
    }

    currentCommand = cmd;
  }
});

/* CANVAS CLICK */
canvas.addEventListener("click", e => {
  const rect = canvas.getBoundingClientRect();
  let x = e.clientX - rect.left;
  let y = e.clientY - rect.top;

  if (SNAP_ON) {
    x = snap(x);
    y = snap(y);
  }

  /* MOVE */
  if (currentCommand === "MOVE") {
    if (!selectedShape) {
      selectedShape = shapes.find(s =>
        s.type === "rect"
          ? x >= s.x && x <= s.x + s.w && y >= s.y && y <= s.y + s.h
          : isNearLine(x, y, s)
      );
      startPoint = { x, y };
      return;
    }

    saveState();

    const dx = x - startPoint.x;
    const dy = y - startPoint.y;

    if (selectedShape.type === "line") {
      selectedShape.x1 += dx;
      selectedShape.y1 += dy;
      selectedShape.x2 += dx;
      selectedShape.y2 += dy;
    }

    if (selectedShape.type === "rect") {
      selectedShape.x += dx;
      selectedShape.y += dy;
    }

    selectedShape = null;
    startPoint = null;
    redraw();
    return;
  }

  /* DRAW */
  if (!startPoint) {
    startPoint = { x, y };
    return;
  }

  saveState();

  if (currentCommand === "LINE") {
    shapes.push({
      type: "line",
      x1: startPoint.x,
      y1: startPoint.y,
      x2: x,
      y2: y
    });
  }

  if (currentCommand === "RECT") {
    shapes.push({
      type: "rect",
      x: startPoint.x,
      y: startPoint.y,
      w: x - startPoint.x,
      h: y - startPoint.y
    });
  }

  startPoint = null;
  redraw();
});
function resizeCanvas() {
  const rect = canvas.getBoundingClientRect();
  canvas.width = rect.width;
  canvas.height = rect.height;
  redraw();
}

window.addEventListener("resize", resizeCanvas);
resizeCanvas();


/* INIT */
drawGrid();
</script>
</body>
</html>
